# Архитектура

## Обзор

ContentZavod — генератор контента для Telegram, работающий через команды и скиллы Claude Code. Не требует отдельного приложения или зависимостей.

## Ключевые компоненты

- **Скилл `authorstyle`** (`.claude/skills/authorstyle/SKILL.md`) — правила генерации текста в авторском стиле
- **Скилл `contentpost`** (`.claude/skills/contentpost/SKILL.md`) — полный цикл: сбор идей → исследование → генерация (3 варианта) → изображение → публикация
- **Команда `/contentpost`** (`.claude/commands/contentpost.md`) — точка входа
- **Описание голоса** (`style/voice.md`) — описание тона, аудитории, характерных черт
- **Примеры стиля** (`style/examples/`) — образцы постов автора для имитации

## Потоки данных

```
Telegram чат идей → getUpdates API
  → Фильтрация по chat_id
  → Для каждой идеи:
    → WebSearch/WebFetch (исследование)
    → 3 субагента параллельно (генерация вариантов)
    → Выбор лучшего по критериям
    → Playwright/OpenRouter (изображение)
    → sendPhoto API (публикация в чат контент-плана)
    → deleteMessage API (удаление из чата идей)
  → Сохранение last_update_id в state/
```

## Ключевые решения

- **3 параллельных субагента** — генерируют разные варианты текста, выбирается лучший
- **Лимит 1024 символа** — один пост = одно сообщение с фото в Telegram
- **Авторская мысль** — если в идее есть текст автора, он сохраняется как основа поста
- **Приоритеты изображений** — источник > поиск > генерация
